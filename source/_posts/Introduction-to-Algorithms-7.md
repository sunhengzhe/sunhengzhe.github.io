---
title: 《算法导论》第七章：快速排序
date: 2016-07-07 22:48:08
tags: [读书笔记, 算法]
---

快速排序和归并排序一样，使用了分治思想。回顾一下归并排序，归并排序是将数组递归拆分，然后两两合并成已排序的数组，一直到合并成为新数组。

快速排序的思想有点相似，但快速排序能够进行原址排序，而不用占用大量的额外空间。

对于数组 `A[p .. r]` 快速排序的三步分治过程如下：

- 分解：数组 `A[p .. r]` 被划分为两个（可能为空）子数组 `A[p .. q - 1]` 和 `A[q + 1 .. r]`，使得 `A[p .. q - 1]` 中的每一个元素都小于等于 `A[q]`，而 `A[q]` 也小于等于 `A[q + 1 .. r]` 中的每个元素。其中，计算下标 q 也是划分过程的一部分。
- 解决：通过递归调用快速排序，对子数组 `A[p .. q - 1]` 和 `A[q + 1 .. r]` 进行排序。
- 合并：因为子数组都是原址排序的，所以不需要合并操作：数组 `A[p .. r]` 已经有序。

核心就在于我们选出了一个主元（即 `A[q]`），将数组划分为了两个子数组，一边小于等于 `A[q]`，一边大于等于 `A[q]`，再分别对两个子数组执行相同操作，一直到不可拆分为止。

伪代码：
*QUICKSORT(A, p, r)*
```
if p < r
  // 找到分界点 A[q] 的位置
  q = PARTITION(A, p, r);
  // 递归调用 A[q] 左边的数组
  QUICKSORT(A, p, q - 1);
  // 递归调用 A[q] 右边的数组
  QUICKSORT(A, q + 1, r);
```

所以算法的关键步骤就是 `PARTITION` 过程，它实现对子数组 `A[p .. r]` 的原址重排。

*PARTITION(A, p, r)*
```
// 数组的最后一个元素（主元）
x = A[r]
// i 是小元素数组的右界
i = p - 1;
// 遍历数组
for j = p to r - 1
  if A[j] <= x
    // 如果该元素比 x 小，小元素数组长度加 1
    i = i + 1
    // 将该元素挪到小元素数组范围里去
    exchange A[i] with A[j]
// 将主元放到大小数组中间
exchange A[i + 1] with A[j]
// 主元的位置
return i + 1
```

快速排序算法的过程涉及到 4 个变量：`p`, `r`, `i`, `j`。将 `A[p .. r]` 数组划分为了四个部分。

1. `p` 到 `i` 之间为第一部分，其值都不大于主元
2. `i + 1` 到 `j - 1` 之间为第二部分，其值都不小于主元
3. `j` 到 `r - 1` 之间是第三部分，其元素等待被分配
4. `r` 处为主元（数组的最后一个元素）

当循环开始时，`j` 从左往右对数组进行扫描，当发现有比主元小的元素时，将 `i` 往右移，并该元素放到 `i` 处，这样循环结束后，整个数组中，`p` 到 `i` 为不大于主元的元素，`i + 1` 到 `r - 1` 为不小于主元的元素，`r` 处为主元，最后我们将 `i + 1` 处的元素和主元交换位置，这样主元就位于了两部分之间。最后，我们对两个子数组进行同样的操作。

javascript 实现
```javascript
function quickSort(arr, p, r) {
  if(p < r) {
    let q = partition(arr, p, r);
    quickSort(arr, p, q - 1);
    quickSort(arr, q + 1, r);
  }
}

function partition(arr, p, r) {
  let x = arr[r];
  let i = p - 1;
  for(var j = p; j < r; j++) {
    if(arr[j] <= x) {
      i++;
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }
  [arr[i + 1], arr[r]] = [arr[r], arr[i + 1]];
  return i + 1;
}

let arr = [13, 19, 9, 5, 12, 8, 7, 4, 21, 2, 6, 11];
quickSort(arr, 0, arr.length - 1);
console.log(arr); // [2, 4, 5, 6, 7, 8, 9, 11, 12, 13, 19, 21]
```